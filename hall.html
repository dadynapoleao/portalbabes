<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Atrizes</title>


    <!-- Modal Structure (Initially Hidden) -->
   <div id="content-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="modal-close-button" onclick="closeModal()">×</span>
            <h3 id="modal-title">Detalhes do Conteúdo</h3>
            <div id="modal-body">
                <!-- Content details will be loaded here -->
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;"> <!-- Flex container for buttons -->
                <div id="modal-back-button-container">
                     <!-- Back button will be added here -->
                </div>
                <div id="modal-link-container">
                    <!-- External link button will be added here -->
                </div>
            </div>
        </div>
    </div>
    
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            display: flex; /* Use flexbox for overall layout */
            min-height: 100vh;
        }

        .container {
            display: flex;
            width: 100%;
            padding: 15px;
            box-sizing: border-box;
        }

        .column {
            background-color: #fff;
            margin: 0 5px;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow-y: auto; /* Add scroll if content overflows */
            height: calc(100vh - 30px); /* Adjust height based on body padding */
            box-sizing: border-box;
        }

        /* Initial State: Only Left Column Visible */
        #actress-list-col {
            flex: 1; /* Take full width initially */
        }

        #actress-detail-col,
        #content-col {
            display: none; /* Hide middle and right columns initially */
        }

        /* State when an actress is selected */
        .container.details-visible #actress-list-col {
            flex: 0 0 25%; /* Fixed width for actress list */
            max-width: 300px; /* Optional max width */
        }

        .container.details-visible #actress-detail-col {
            display: block;
            flex: 0 0 30%; /* Fixed width for details */
            max-width: 400px; /* Optional max width */
        }

        .container.details-visible #content-col {
            display: block;
            flex: 1; /* Takes remaining space */
        }

        /* Actress List Styling */
        #actress-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .actress-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .actress-item:hover {
            background-color: #f0f0f0;
        }

         .actress-item.selected {
            background-color: #e0e0e0;
            font-weight: bold;
        }

        .actress-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 50%;
            margin-right: 10px;
        }

        .actress-info span {
            display: block;
            font-size: 0.9em;
        }
         .actress-info .name {
            font-weight: bold;
            font-size: 1em;
         }
         .actress-info .age,
         .actress-info .rating {
            color: #555;
         }


        /* Actress Detail Styling */
        #actress-details h3 {
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
         #actress-details div {
             margin-bottom: 8px;
             word-wrap: break-word; /* Prevent long strings from overflowing */
         }
         #actress-details strong {
            display: inline-block;
            min-width: 100px; /* Align keys */
            color: #333;
         }
         /* --- MODIFIED: Smaller image in middle column --- */
         #actress-details img.detail-photo {
             max-width: 200px; /* Limit width */
             max-height: 250px; /* Optional: Limit height */
             width: auto; /* Maintain aspect ratio */
             height: auto; /* Maintain aspect ratio */
             border-radius: 4px;
             margin-top: 10px;
             display: block; /* Ensure it takes block layout */
         }


        /* Content Card Styling */
        #content-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Responsive grid */
            gap: 15px;
        }

        .content-card {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
            overflow: hidden;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .content-card img {
            width: 100%;
            height: 180px; /* Fixed height for consistency */
            object-fit: cover;
            display: block;
        }

        .content-card .title {
            padding: 8px;
            font-size: 0.9em;
            min-height: 40px; /* Ensure space for title */
            display: flex;
            align-items: center;
            justify-content: center;
        }

         /* Loading/Error indicators */
         .loading, .error {
             text-align: center;
             padding: 20px;
             color: #888;
         }


        /* Modal Styling */
        .modal-overlay {
            position: fixed; /* Stay in place */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Black background with opacity */
            z-index: 1000; /* Sit on top */
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .modal-content {
            background-color: #fff;
            padding: 25px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 600px; /* Limit modal width */
            width: 90%;
            position: relative;
            max-height: 80vh; /* Limit modal height */
            overflow-y: auto; /* Add scroll if content is tall */
        }

        .modal-close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            line-height: 1;
        }

        .modal-close-button:hover {
            color: #333;
        }

        #modal-body div {
            margin-bottom: 8px;
            word-wrap: break-word;
        }
        #modal-body strong {
           display: inline-block;
           min-width: 80px; /* Align keys in modal */
           color: #333;
        }
        #modal-link-container button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }
        #modal-link-container button:hover {
            background-color: #0056b3;
        }
        #modal-body img.modal-detail-image {
            max-width: 100%;
            height: auto;
            margin-top: 10px;
            border-radius: 4px;
        }


           /* Modal Content Refinements */
        .modal-content {
             /* Consider slightly larger max-width if needed for scenes/actresses */
            max-width: 700px;
        }

        /* --- Styles for Content within Modal --- */

        /* Image Styling in Modal */
        #modal-body img.modal-detail-image {
            max-width: 100%; /* Default max width */
            height: auto;
            max-height: 300px; /* Limit height */
            margin-top: 10px;
            border-radius: 4px;
            display: block; /* Center if needed */
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 15px;
        }
         /* Specific style for smaller movie images in modal */
        #modal-body img.modal-detail-image.movie-image {
            max-width: 250px; /* Smaller max width for movies */
             max-height: 250px;
        }

        /* Year Display */
        #modal-body .modal-year {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 15px;
        }

        /* Actresses List in Modal */
        .modal-actress-list-container {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .modal-actress-list-container h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
        }
         .modal-actress-list {
             display: flex;
             flex-wrap: wrap;
             gap: 15px; /* Spacing between actresses */
             padding: 0;
             list-style: none;
         }
         .modal-actress-item {
             display: flex;
             flex-direction: column; /* Stack image and name */
             align-items: center;
             text-align: center;
             cursor: pointer;
             padding: 5px;
             border-radius: 4px;
             transition: background-color 0.2s ease;
             max-width: 80px; /* Control width */
         }
          .modal-actress-item:hover {
              background-color: #f0f0f0;
          }
         .modal-actress-item img {
             width: 60px; /* Size of actress image */
             height: 60px;
             object-fit: cover;
             border-radius: 50%;
             margin-bottom: 5px;
         }
         .modal-actress-item span {
             font-size: 0.85em;
             word-wrap: break-word;
         }

        /* Movie Scenes List in Modal */
        .modal-scenes-container {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        .modal-scenes-container h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
        }
        .modal-scene-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); /* Responsive grid */
            gap: 10px;
        }
        .modal-scene-card {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
            overflow: hidden;
            text-align: center;
            font-size: 0.8em;
             /* cursor: pointer; */ /* Add if making scenes clickable later */
             /* transition: box-shadow 0.2s ease; */
        }
         /* .modal-scene-card:hover {
             box-shadow: 0 2px 5px rgba(0,0,0,0.1);
         } */
         .modal-scene-card img {
             width: 100%;
             height: 80px; /* Smaller height for scene thumbs */
             object-fit: cover;
             display: block;
         }
         .modal-scene-card .title {
             padding: 5px;
             min-height: 25px;
             display: flex;
             align-items: center;
             justify-content: center;
         }

         /* Back Button Styling */
         #modal-back-button-container button {
             padding: 8px 12px;
             background-color: #6c757d; /* Grey color */
             color: white;
             border: none;
             border-radius: 4px;
             cursor: pointer;
             font-size: 0.9em;
             margin-right: 10px; /* Space between back and external link */
         }
         #modal-back-button-container button:hover {
             background-color: #5a6268;
         }
        
    </style>
</head>
<body>
    <div class="container" id="main-container">
        <div class="column" id="actress-list-col">
            <h2>Atrizes</h2>
            <ul id="actress-list">
                <li class="loading">Carregando atrizes...</li>
            </ul>
        </div>
        <div class="column" id="actress-detail-col">
            <div id="actress-details">
                <!-- Details will be loaded here -->
            </div>
        </div>
        <div class="column" id="content-col">
            <h2>Conteúdo Relacionado</h2>
            <div id="content-cards">
                <!-- Content cards will be loaded here -->
            </div>
             <div id="content-message" class="loading" style="display: none;"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
 <script type="module">
    // ... (Firebase imports and config remain the same) ...
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = { /* ... Your config ... */ };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- DOM Elements ---
    // ... (Keep main elements: mainContainer, actressList, etc.) ...
    const modal = document.getElementById('content-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const modalLinkContainer = document.getElementById('modal-link-container');
    // --- NEW: Back Button Container ---
    const modalBackButtonContainer = document.getElementById('modal-back-button-container');

    let selectedActressElement = null;
    // --- NEW: State for Modal Navigation ---
    let previousModalState = null; // To store { type, id } for back button

    // --- Helper Functions (calculateAge, displayMessage, clearMessage) ---
    // ... (Keep these functions as they are) ...
    function calculateAge(birthDateString) { /* ... */ }
    function displayMessage(element, message, isError = false) { /* ... */ }
    function clearMessage(element) { /* ... */ }

    // --- Core Logic ---

    // 1. Load Actresses List
    async function loadActresses() { /* ... (Keep as is, with sorting) ... */ }

    // 2. Handle Actress Click
    async function handleActressClick(actressId, listItemElement) { /* ... (Keep as is) ... */ }

    // 3. Display Actress Details (Main Column - Keep as is)
    function displayActressDetails(data) { /* ... (Keep as is) ... */ }

    // 4. Load Related Content (Keep as is)
    async function loadRelatedContent(actressId) { /* ... (Keep as is) ... */ }

    // 5. Create Content Card HTML (Ensure only Image + Title)
    function createContentCard(imageUrl, title, type, id) {
        // console.log(`Creating card for ${type} ID: ${id}, Title: ${title}`); // Optional log
        const card = document.createElement('div');
        card.classList.add('content-card');
        card.dataset.type = type; // Store type for click
        card.dataset.id = id;     // Store ID for click

        const img = document.createElement('img');
        let finalImageUrl = imageUrl;
        // Handle image object/string
        if (typeof imageUrl === 'object' && imageUrl !== null && imageUrl.hasOwnProperty('width')) {
            const urlKey = Object.keys(imageUrl).find(k => typeof imageUrl[k] === 'string' && imageUrl[k].startsWith('http'));
            finalImageUrl = urlKey ? imageUrl[urlKey] : 'placeholder.png';
        } else if (typeof imageUrl !== 'string' || !imageUrl) {
            finalImageUrl = 'placeholder.png';
        }
        img.src = finalImageUrl;
        img.alt = title || type;
        img.onerror = () => { img.src = 'placeholder.png'; img.onerror=null; }

        const titleDiv = document.createElement('div');
        titleDiv.classList.add('title');
        // --- Ensure only title is displayed on card ---
        titleDiv.textContent = `${title || 'Sem Título'}`;

        card.appendChild(img);
        card.appendChild(titleDiv);

        // Add click listener to show modal
        card.addEventListener('click', () => showContentDetails(type, id));

        contentCardsContainer.appendChild(card);
    }

    // --- MODAL Functions ---

    // 6. Show Content Details in Modal (Heavily Modified)
    async function showContentDetails(type, id) {
        console.log(`Showing details for ${type} ID: ${id}`);
        // Reset modal state
        previousModalState = null;
        modalBackButtonContainer.innerHTML = ''; // Clear back button
        modalBody.innerHTML = '<div class="loading">Carregando...</div>';
        modalLinkContainer.innerHTML = '';
        modal.style.display = 'flex';

        let collectionName = '';
        switch (type) {
            case 'Cena': collectionName = 'cenas'; break;
            case 'Vídeo': collectionName = 'videos'; break;
            case 'Filme': collectionName = 'filmes'; break;
            default:
                modalBody.innerHTML = '<div class="error">Tipo de conteúdo inválido.</div>'; return;
        }

        try {
            const docSnap = await getDoc(doc(db, collectionName, id));

            if (docSnap.exists()) {
                const data = docSnap.data();
                console.log("Content data:", data);
                modalTitle.textContent = data.nome || `Detalhes de ${type}`;
                modalBody.innerHTML = ''; // Clear loading

                // --- Display Limited Fields ---

                // 1. Image (Conditional Size)
                let imageUrl = data.imagem;
                if (imageUrl) {
                    let finalImageUrl = imageUrl;
                    if (typeof imageUrl === 'object' && imageUrl !== null && imageUrl.hasOwnProperty('width')) {
                        const urlKey = Object.keys(imageUrl).find(k => typeof imageUrl[k] === 'string' && imageUrl[k].startsWith('http'));
                        finalImageUrl = urlKey ? imageUrl[urlKey] : null;
                    } else if (typeof imageUrl !== 'string') { finalImageUrl = null; }

                    if (finalImageUrl) {
                       const img = document.createElement('img');
                       img.src = finalImageUrl;
                       img.alt = data.nome || type;
                       img.classList.add('modal-detail-image');
                       // Add specific class for smaller movie images
                       if (type === 'Filme') {
                           img.classList.add('movie-image');
                       }
                       img.onerror = () => { img.style.display = 'none'; };
                       modalBody.appendChild(img);
                    }
                }

                // 2. Year
                if (data.ano) {
                    const yearDiv = document.createElement('div');
                    yearDiv.classList.add('modal-year');
                    yearDiv.textContent = `Ano: ${data.ano}`;
                    modalBody.appendChild(yearDiv);
                }

                // --- Placeholder for Actresses & Scenes ---
                const actressesContainer = document.createElement('div');
                actressesContainer.classList.add('r');
                actressesContainer.innerHTML = `<h4>Atrizes</h4><div class="loading">Carregando atrizes...</div>`;
                modalBody.appendChild(actressesContainer);

                let scenesContainer = null;
                if (type === 'Filme') {
                    scenesContainer = document.createElement('div');
                    scenesContainer.classList.add('modal-scenes-container');
                    scenesContainer.innerHTML = `<h4>Cenas do Filme</h4><div class="loading">Carregando cenas...</div>`;
                    modalBody.appendChild(scenesContainer);
                }

                // --- Add External Link Button ---
                if (data.pagina && typeof data.pagina === 'string' && data.pagina.trim() !== '') {
                    const linkButton = document.createElement('button');
                    linkButton.textContent = 'Abrir Página Externa';
                    linkButton.onclick = () => window.open(data.pagina, '_blank');
                    modalLinkContainer.appendChild(linkButton);
                } else {
                    modalLinkContainer.innerHTML = '<i>(Nenhuma página externa)</i>';
                }

                // --- Asynchronously Load Actresses and Scenes ---
                loadActressesForModal(data.atores || [], actressesContainer); // Pass empty array if undefined

                if (type === 'Filme') {
                    loadScenesForModal(data.cenas || [], scenesContainer); // Pass empty array if undefined
                }

            } else {
                modalBody.innerHTML = '<div class="error">Conteúdo não encontrado.</div>';
            }
        } catch (error) {
            console.error(`Erro ao buscar ${type} ${id}: `, error);
            modalBody.innerHTML = '<div class="error">Erro ao carregar detalhes.</div>';
        }
    }

    // 7. Asynchronously Load Actresses into Modal
    async function loadActressesForModal(actressIds, containerElement) {
        if (!actressIds || actressIds.length === 0) {
            containerElement.innerHTML = '<h4>Atrizes</h4><i>Nenhuma atriz associada.</i>';
            return;
        }

        const listElement = document.createElement('ul');
        listElement.classList.add('modal-actress-list');
        containerElement.innerHTML = '<h4>Atrizes</h4>'; // Clear loading text
        containerElement.appendChild(listElement);

        let foundCount = 0;
        const fetchPromises = actressIds.map(async (actressId) => {
            try {
                const actressDoc = await getDoc(doc(db, "atores", actressId));
                if (actressDoc.exists()) {
                    const actressData = actressDoc.data();
                    foundCount++;

                    const li = document.createElement('li');
                    li.classList.add('modal-actress-item');
                    li.onclick = () => showActressDetailsInModal(actressId, { type: containerElement.closest('.modal-content').dataset.contentType, id: containerElement.closest('.modal-content').dataset.contentId }); // Store current content type/id

                    const img = document.createElement('img');
                    img.src = actressData.foto || 'placeholder.png';
                    img.alt = actressData.nome;
                    img.onerror = () => { img.src = 'placeholder.png'; img.onerror=null; }

                    const nameSpan = document.createElement('span');
                    nameSpan.textContent = actressData.nome || 'Nome Desconhecido';

                    li.appendChild(img);
                    li.appendChild(nameSpan);
                    listElement.appendChild(li);
                } else {
                     console.warn(`Actress document not found: ${actressId}`);
                 }
            } catch (error) {
                console.error(`Error fetching actress ${actressId}:`, error);
            }
        });

        await Promise.all(fetchPromises);

        if (foundCount === 0) {
             containerElement.innerHTML = '<h4>Atrizes</h4><i>Não foi possível carregar detalhes das atrizes.</i>';
        }

         // Store content type/id on modal content for back navigation
         containerElement.closest('.modal-content').dataset.contentType = containerElement.closest('.modal-content').dataset.contentType || document.querySelector(`.content-card[data-id='${containerElement.closest('.modal-content').dataset.contentId}']`)?.dataset.type; // Find type if needed
         containerElement.closest('.modal-content').dataset.contentId = containerElement.closest('.modal-content').dataset.contentId || document.querySelector(`.content-card[data-type='${containerElement.closest('.modal-content').dataset.contentType}']`)?.dataset.id;; // Find id if needed

    }


    // 8. Asynchronously Load Scene Cards into Modal (for Movies)
    async function loadScenesForModal(sceneIds, containerElement) {
         if (!sceneIds || sceneIds.length === 0) {
            containerElement.innerHTML = '<h4>Cenas do Filme</h4><i>Nenhuma cena associada.</i>';
            return;
        }

        const cardsContainer = document.createElement('div');
        cardsContainer.classList.add('modal-scene-cards');
        containerElement.innerHTML = '<h4>Cenas do Filme</h4>'; // Clear loading
        containerElement.appendChild(cardsContainer);

        let foundCount = 0;
        const fetchPromises = sceneIds.map(async (sceneId) => {
             try {
                const sceneDoc = await getDoc(doc(db, "cenas", sceneId));
                if (sceneDoc.exists()) {
                    const sceneData = sceneDoc.data();
                    foundCount++;

                    const card = document.createElement('div');
                    card.classList.add('modal-scene-card');
                    // Optionally make scene cards clickable later:
                    // card.onclick = () => showContentDetails('Cena', sceneId);

                    const img = document.createElement('img');
                    let finalImageUrl = sceneData.imagem;
                    if (typeof finalImageUrl === 'object' && finalImageUrl !== null && finalImageUrl.hasOwnProperty('width')) {
                        const urlKey = Object.keys(finalImageUrl).find(k => typeof finalImageUrl[k] === 'string' && finalImageUrl[k].startsWith('http'));
                        finalImageUrl = urlKey ? finalImageUrl[urlKey] : 'placeholder.png';
                    } else if (typeof finalImageUrl !== 'string' || !finalImageUrl) {
                        finalImageUrl = 'placeholder.png';
                    }
                    img.src = finalImageUrl;
                    img.alt = sceneData.nome;
                    img.onerror = () => { img.src = 'placeholder.png'; img.onerror=null; }

                    const titleDiv = document.createElement('div');
                    titleDiv.classList.add('title');
                    titleDiv.textContent = sceneData.nome || 'Sem Título';

                    card.appendChild(img);
                    card.appendChild(titleDiv);
                    cardsContainer.appendChild(card);
                 } else {
                     console.warn(`Scene document not found: ${sceneId}`);
                 }
             } catch (error) {
                 console.error(`Error fetching scene ${sceneId}:`, error);
             }
        });

        await Promise.all(fetchPromises);

        if (foundCount === 0) {
             containerElement.innerHTML = '<h4>Cenas do Filme</h4><i>Não foi possível carregar detalhes das cenas.</i>';
        }
    }

    // 9. Show Actress Details IN Modal (Replaces Content)
    async function showActressDetailsInModal(actressId, currentContentState) {
        console.log(`Showing details for Actress ID: ${actressId} in modal.`);

        // Store the previous state for the back button
        previousModalState = currentContentState; // { type: 'Filme', id: 'movieID123' }

        // Show loading in modal
        modalBody.innerHTML = '<div class="loading">Carregando detalhes da atriz...</div>';
        modalLinkContainer.innerHTML = ''; // Clear external link
        modalBackButtonContainer.innerHTML = ''; // Clear potential old back button

        try {
            const actressDoc = await getDoc(doc(db, "atores", actressId));
            if (actressDoc.exists()) {
                const data = actressDoc.data();
                modalTitle.textContent = data.nome || 'Detalhes da Atriz';
                modalBody.innerHTML = ''; // Clear loading

                // Display actress details (similar to displayActressDetails but simplified for modal)
                if (data.foto) {
                    const img = document.createElement('img');
                    img.src = data.foto;
                    img.alt = data.nome;
                    img.classList.add('modal-detail-image'); // Reuse style, maybe adjust if needed
                    img.onerror = () => { img.style.display = 'none'; };
                    modalBody.appendChild(img);
                }

                const skipActressFields = ['foto', 'nome', 'timestamp']; // Fields to skip
                 for (const key in data) {
                     if (data.hasOwnProperty(key) && !skipActressFields.includes(key)) {
                        const detailDiv = document.createElement('div');
                        let value = data[key];
                        let label = key;

                        if (key === 'dataNascimento') {
                            detailDiv.innerHTML = `<strong>${label}:</strong> ${value || 'N/A'}`;
                            modalBody.appendChild(detailDiv);
                            const ageDiv = document.createElement('div');
                            ageDiv.innerHTML = `<strong>Idade:</strong> ${calculateAge(value)}`;
                            modalBody.appendChild(ageDiv);
                            continue;
                        }
                        else if (key === 'peso' && value !== undefined && value !== null) { value = `${value} kg`; }
                        else if (key === 'altura' && value !== undefined && value !== null) { value = `${value} cm`; }

                        detailDiv.innerHTML = `<strong>${label}:</strong> ${value}`;
                        modalBody.appendChild(detailDiv);
                    }
                }

                // Add Back Button
                const backButton = document.createElement('button');
                backButton.textContent = '← Voltar';
                backButton.onclick = () => restoreContentDetailsModal();
                modalBackButtonContainer.appendChild(backButton);


            } else {
                 modalBody.innerHTML = '<div class="error">Detalhes da atriz não encontrados.</div>';
                 // Optionally add back button even on error
                 const backButton = document.createElement('button');
                 backButton.textContent = '← Voltar';
                 backButton.onclick = () => restoreContentDetailsModal();
                 modalBackButtonContainer.appendChild(backButton);
            }

        } catch (error) {
             console.error(`Error fetching actress details ${actressId} for modal:`, error);
             modalBody.innerHTML = '<div class="error">Erro ao carregar detalhes da atriz.</div>';
             // Optionally add back button even on error
             const backButton = document.createElement('button');
             backButton.textContent = '← Voltar';
             backButton.onclick = () => restoreContentDetailsModal();
             modalBackButtonContainer.appendChild(backButton);
        }
         // Make sure content type/id is stored on the modal content element itself
         // This might need refinement if the structure changes drastically
         modalBody.closest('.modal-content').dataset.contentType = previousModalState.type;
         modalBody.closest('.modal-content').dataset.contentId = previousModalState.id;
    }


    // 10. Restore Previous Content View in Modal
    function restoreContentDetailsModal() {
        if (previousModalState && previousModalState.type && previousModalState.id) {
            console.log(`Restoring modal view for ${previousModalState.type} ID: ${previousModalState.id}`);
            // Refetch the original content details
            showContentDetails(previousModalState.type, previousModalState.id);
        } else {
            console.warn("Cannot go back, previous modal state is missing.");
            // Optionally just close the modal if back state is lost
            closeModal();
        }
    }


    // 11. Close Modal Function
    function closeModal() {
        modal.style.display = 'none';
        modalBody.innerHTML = '';
        modalLinkContainer.innerHTML = '';
        modalBackButtonContainer.innerHTML = ''; // Clear back button on close
        previousModalState = null; // Reset state
    }

    // Close modal if user clicks outside the content area
    window.addEventListener('click', (event) => {
        if (event.target == modal) {
            closeModal();
        }
    });


    // --- Initial Load ---
    loadActresses();

</script>
</body>
</html>
